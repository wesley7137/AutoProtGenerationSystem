Title: Stochastic Biological System-of-Systems Modelling for iPSC Culture
Abstract:   Large-scale manufacturing of induced pluripotent stem cells (iPSCs) is
essential for cell therapies and regenerative medicines. Yet, iPSCs form large
cell aggregates in suspension bioreactors, resulting in insufficient nutrient
supply and extra metabolic waste build-up for the cells located at the core.
Since subtle changes in micro-environment can lead to a heterogeneous cell
population, a novel Biological System-of-Systems (Bio-SoS) framework is
proposed to model cell-to-cell interactions, spatial and metabolic
heterogeneity, and cell response to micro-environmental variation. Building on
stochastic metabolic reaction network, aggregation kinetics, and
reaction-diffusion mechanisms, the Bio-SoS model characterizes causal
interdependencies at individual cell, aggregate, and cell population levels. It
has a modular design that enables data integration and improves predictions for
different monolayer and aggregate culture processes. In addition, a variance
decomposition analysis is derived to quantify the impact of factors (i.e.,
aggregate size) on cell product health and quality heterogeneity.

Full Text: Corresponding author (*) Wei Xie (w.xie@northeastern.edu) and Sarah W. Harcum (harcum@clemson.edu)    Stochastic Biological System-of-Systems Modelling  for iPSC Culture  Hua Zheng1, Sarah W. Harcum2,*, Jinxiang Pei1, Wei Xie1,* 1. Mechanical and Industrial Engineering, Northeastern University, Boston, MA 02115 2. Bioengineering, Clemson University, Clemson, SC, USA Abstract Large-scale manufacturing of induced pluripotent stem cells (iPSCs) is essential for cell therapies and regenerative medicines. Yet, iPSCs form large cell aggregates in suspension bioreactors, resulting in insufficient nutrient supply and extra metabolic waste build-up for the cells located at the core. Since subtle changes in micro-environment can lead to a heterogeneous cell population, a novel Biological System-of-Systems (Bio-SoS) framework is proposed to model cell-to-cell interactions, spatial and metabolic heterogeneity, and cell response to micro-environmental variation. Building on stochastic metabolic reaction network, aggregation kinetics, and reaction-diffusion mechanisms, the Bio-SoS model characterizes causal interdependencies at individual cell, aggregate, and cell population levels. It has a modular design that enables data integration and improves predictions for different monolayer and aggregate culture processes. In addition, a variance decomposition analysis is derived to quantify the impact of factors (i.e., aggregate size) on cell product health and quality heterogeneity.  Introduction Since induced pluripotent stem cells (iPSCs) have the potential to differentiate into any cell type in the body, the discovery and availability of iPSCs has created numerous opportunities in the fields of regenerative medicines, cell therapies, drug discovery, and tissue engineering1, 2. Large-scale manufacturing of iPSCs will be essential to support these clinical and research applications, not currently met to date. While iPSCs can be grown in small colonies in adherent monolayers (such as in petri-dish), this culture method is not ideal for large-scale manufacturing. Thus, stirred suspension cultures are recommended for   manufacturing purposes3, 4. Due to strong cell-to-cell interactions, one challenge that confronts large-scale iPSC cultures is the tendency of iPSCs to self-aggregate, which can lead to large aggregates in suspension bioreactors. Further, stirred suspension cultures can experience complex hydrodynamics conditions that can affect cell behaviours, including aggregation, metabolism, apoptosis, expansion, and differentiation5.   As stem cells are highly sensitive to environmental conditions, a critical concern for iPSC aggregate cultures is spatial heterogeneity. Basically, nutrients and differentiation factors can become unevenly distributed in iPSC aggregates. These variable conditions across an aggregate can result in heterogeneous cell populations and cell death6, 7, 8. Therefore, understanding spatial heterogeneity and controlling aggregate size is crucial for predictable and consistent results in iPSC cultures.  Metabolic kinetic modelling is valuable to advance the scientific understanding of stem cell cultures, predict cell growth and functional behaviours, and guide feeding and agitation strategies. While several models have been developed to describe different aspects of iPSC cultures, a comprehensive mechanistic model that captures the multi-scale and heterogeneity nature of iPSC aggregate cultures is still lacking. For example, the Monod-type unstructured-unsegregated culture model developed by Galvanauskas et al. 9 assumes homogeneity of the entire iPSC population and does not account for intracellular variability. The population balance model proposed by Bartolini et al. 10 focuses on the temporal evolution of the size distribution of embryonic stem cell (ESC) aggregates, while Van Winkle et al. 6 modelled a single human ESC (hESC) spherical aggregate, yet neglected the dynamics of the cell population. Recently, Odenwelder et al. 11 applied a metabolic flux analysis (MFA) 12, 13 to describe the effects of glucose and lactate concentrations on monolayer iPSCs. And Wu et al. 14 developed a mechanistic model that described cell aggregation and considered oxygen transport for iPSC aggregate cultures, however, neglected metabolite diffusion, intracellular metabolism, and cell metabolic heterogeneity.  Existing mechanistic models for mammalian cell cultures often assume the cell population is homogenous. And thus, these metabolic models overlook the stochastic nature of living cells. For cultures such as Chinese hamster ovary (CHO) cells and yeast, the assumption of spatial homogeneity may be sufficient in well-stirred systems where cell aggregates are non-existent or only involve a few cells.  In these cases, unsegregated models, such as dynamic flux balance analyses12, 15 and cell culture kinetic models16 have been demonstrated to predict culture performance. But unlike single cell suspension cultures, aggregate cultures, common to iPSCs, are not homogenous. As the aggregate size increases, spatial heterogeneity likely increases cell-to-cell variation and increases metabolic heterogeneity. While stochastic chemical kinetics17, 18 and queueing network models19, 20 have been developed to describe the dynamics and inherent   stochasticity of chemically reacting systems and metabolic networks, these approaches do not account for the effect of cell aggregation on metabolite variations and potential cell heterogeneity common to iPSC cultures. Additionally, spatial variance component analysis (SVCA) was introduced to study spatial heterogeneity contributed by cell-to-cell interactions, intrinsic effect, and environmental effect21. However, this study is built on the random effect model that is challenging to faithfully characterize the underlying complex interaction mechanisms and causal interdependencies from molecular to cellular to macroscopic levels.  In a broader scope, several multiscale bioprocess models have been developed for studying aggregate structures in the clinical studies, such as cancer tissues22, 23, and biofilms24. Notable examples include software packages like PhysiCell25, Chaste26, ChemChaste27, BMX28, and Morpheus29. These tools fall under the category of agent-based models, which integrate cell-based metabolic reactions, reaction-diffusion processes, and individual cell growth dynamics. Furthermore, these models have the potential to include specialized stochastic cell models, allowing them to represent regulatory structures and account for the mechanical and chemical interactions. While these methods could be effective for modelling small aggregate systems, these models become computationally prohibitive when applied to large-scale iPSC manufacturing processes.   To overcome the limitations of existing methods, this paper presents a novel biological systems-of-system (Bio-SoS) model with modular design to characterize the mechanisms in iPSC aggregate cultures and describe the spatial-temporal causal interdependencies from individual cells to cell aggregates, and to cell population. It is built on mechanistic modules, including: (1) a stochastic metabolic network (SMN) model describing cell metabolic response to environmental variation; (2) a population balance model (PBM) describing the iPSC proliferation, collision, and aggregation process due to cell-to-cell interactions; and (3) a reaction-diffusion model (RSM) characterizing spatial heterogeneity of micro-environmental conditions which accounts for the different diffusion rates of nutrient and metabolite molecules through cell aggregates. The modular design allows us to organically assemble individual mechanistic modules to construct a Bio-SoS model for iPSC aggregate cultures, which facilitates the integration of data and information collected from different cell culture processes with different dynamics and spatial heterogeneous micro-environment conditions. This Bio-SoS modelling philosophy for multi-scale bioprocess is extendable and applicable to general biological ecosystems, accounting for complex interactions and inherent stochasticity.  The proposed Bio-SoS framework represents a novel in-silico process analytical technology (PAT) for iPSC aggregate cultures, offering valuable insights into individual cell response to micro-environmental changes   and metabolic information across distinct aggregate locations. The key contributions are threefold. First, the proposed multi-scale Bio-SoS model has a modular design that facilitates the integration of data from different culture conditions (such as 2D monolayer cultures used in the lab and aggregate cultures recommended for industrial manufacturing). This modular design will accelerate iPSC large-scale manufacturing process development without conducting extensive experiments. It can provide a valuable tool for yield optimization and cell product quality consistency control.  Second, since the objective for iPSC cultures is undifferentiated biomass, i.e., the cells are the product, the proposed variance decomposition analysis on the Bio-SoS mechanistic model enhances our systematic understanding of iPSC culture spatial heterogeneity, predicts the impact of critical factors (i.e., aggregate size) on metabolic heterogeneity, and enables us to avoid unwanted cell death or heterogeneous cell populations during expansion. It can identify the root-causes of cell-to-cell variation, analyze intracellular metabolism at different positions within an aggregate, and determine the optimal aggregate size range across different bioreactor conditions. Third, the proposed Bio-SoS simulation provides a comprehensive and efficient way to account for the complex and stochastic nature of iPSC aggregate and monolayer cultures. In contrast to existing agent-based simulation tools22-29, the Bio-SoS model is a specialized simulation tool tailored for iPSC cultures. It can improve simulation efficiency through: (1) modelling iPSC aggregation using population balance equations to ensure a more efficient  representation of cellular dynamics during aggregation; (2) constructing a coarse-grained approach that divides each aggregate into small spherical shells and assumes cellular metabolisms and micro-environment are homogeneous in each spherical shell; and (3) utilizing a single-cell stochastic metabolic network model to predict the cell metabolic response to environmental variation.   Results  Bio-SoS Model for Multi-scale iPSC Cultures Within (3-dimensional or 3D) aggregate cultures, cells proliferate and interact with each other at three levels: intracellular metabolic reactions, metabolites and nutrients diffusion through the cell aggregates, and aggregate interactions within bulk culture fluid. Each individual cell within the culture is a complex system with potentially stochastic behavior. And as these cells cluster together, a larger system of systems is formed with micro-environmental conditions shaped by cell interactions. Taken together, aggregates comprise the entire iPSC population in the bioreactor interacting with the bulk media.   The proposed Bio-SoS model characterizes the complex interactions and regulatory reaction network mechanisms from molecular- to cellular-, and to macro-kinetics; see Fig. 1. Based on the causal   interdependencies between these biological systems, the Bio-SoS model was constructed incorporating three interconnected mechanistic modules summarized below (see “Methods” section for details). The intracellular regulatory metabolic reaction network is connected to the aggregate via the transport of metabolites across the cellular membrane, while cells within an aggregate are linked through the diffusion of intra-aggregate metabolites and nutrient supplies. This Bio-SoS reaction network mechanism for iPSC aggregate culture is characterized through the integration of a reaction-diffusion model (RDM) and single-cell stochastic metabolic networks (SMNs) quantifying the metabolic heterogeneity. The aggregation process of the cell population is effectively characterized using PBM. The Bio-SoS model can both sample and computational efficiently characterize the spatial heterogeneity in micro-environmental conditions and the variability in cell-to-cell metabolism.  
 Fig. 1 An illustration of the proposed Bio-SoS for iPSC aggregate culture (Created with BioRender.com). (a) The sizes of cell aggregates grow over culture time. The PBM model was used to describe the dynamics of cell aggregation process and predict the aggregate size distribution. (b) Cell aggregates are spatially decomposed into equally sized small spherical shells. In each shell, the metabolic concentrations are assumed to be homogenous. RDM was used to characterize the intra-aggregate diffusion dynamics of nutrient and metabolite concentrations, showing that the nutrient concentrations increased as distance from the center increases, while the metabolic waste concentrations decreased from the center. (c) The SMN is built to describe the intracellular reactions to microenvironmental perturbations. Suppose cells residing in each spherical shell are homogeneous. The metabolic heterogeneity is characterized by the difference in fluxes between exterior cells and inner cells locating at different positions in aggregates.
6   1. Population balance model (PBM).  A PBM is used to describe the aggregation process accounting for cell proliferation and coalescence/collisions of iPSC aggregates.  2. Reaction-diffusion Model (RDM). It is constructed to describe cell-to-cell interactions and the intra-aggregate fluid dynamics, which is a fundamental process involving the transport of reacting nutrients and metabolites through iPSC aggregates. This movement is influenced by the metabolite production/consumption and a diffusive flux that is proportional to the local concentration gradient. By considering the complex interplay between individual cell metabolic reactions and their micro-environment, this model can estimate how long cells might experience a particular condition. The diffusion coefficients used in this study are listed in Supplementary Table 4. 3. Stochastic metabolic network (SMN) for single cells. The metabolic molecular reaction network is constructed from the curated biochemical interactions based on experimental data11. These interactions characterize intracellular metabolisms and the cellular responses to environmental perturbations. By following the studies on stochastic molecular reaction models19, 20, a Poisson process is utilized for modelling molecular enzymatic reaction occurrence within the SMN to capture the random nature of enzyme-substrate collisions and subsequent reactions. The expected metabolic reaction rates for homogeneous cell population were derived from Wang et al. 30 and calibrated using 2D monolayer culture experimental data of extracellular metabolites and intracellular isotopic measurements from Odenwelder et al. 11. The iPSC stochastic metabolic network (composed of 32 metabolites and 38 reactions) mainly focuses on central carbon metabolism and contains the major reactions for glucose consumption, the TCA cycle, anaplerosis, pentose phosphate pathway (PPP), and amino acid metabolism. The reactions, metabolites and enzymes that are used in this study are listed in Supplementary Table 1, 2, and 3.   Built on the Bio-SoS model characterizing the causal interdependencies of iPSC aggregate culture, a spatial variance analysis approach is derived to study the root-cause of cell metabolic heterogeneity (see “Methods” section for details), which can be used to guide the control of iPSC cultures, including aggregate size. Because the system comprises aggregates of multiple sizes, cell aggregates were numerically classified into 𝐿 groups. To further consider the spatial heterogeneity in each aggregate with radius, say 𝑅ℓ for ℓ=1,2,…,𝐿, the aggregates were divided into spherical shells; see the illustration of cells located in the 𝑛-th spherical shell [𝑅ℓ"#$,𝑅ℓ"]	in Fig. 1(b). The proposed Bio-SoS variance analysis approach can assess the contribution of spatial heterogeneity from aggregates with different sizes to the cell 7  product metabolic variation and quantify the metabolic heterogeneity through studying the relative changes of metabolic fluxes for cells residing at different locations and time within an aggregate.   Model Validation for Bio-SoS Framework The three individual model modules (i.e., PBM, RDM, and SMN) were validated with experimental data from literature7, 11, 14, then the integrated Bio-SoS model was validated based on both monolayer culture data from Odenwelder et al. 11 and aggregate culture data from Kwok et al. 7.  First, the PBM was validated using cell proliferation and aggregation dynamics data from Wu et al.14. The experimental and model predicted aggregate growth profiles are shown in Fig. 2a and the time-varying aggregate size distribution is illustrated in Fig. 2b. Overall, the PBM captured the aggregation dynamics. The model-based prediction is obtained through solving the PBM numerically by using finite differences over equally spaced interval (i.e., 1 𝜇m) in the radius domain of an aggregate and 0.1 hour in the time domain31.   Second, the RDM was validated by using stirred-tank suspension bioreactor data from Wu et al.14. The transport of metabolites and nutrients through 3D aggregates is crucial for the effectiveness of cultivation systems. This is especially significant in stem cell cultures, as cell metabolism determines iPSC product functional quality attributes and it plays an important role in determining pluripotency and lineage specification32. Given the stem cell aggregate property (i.e., porosity and tortuosity) estimated based on the measures in Wu et al.14, the RDM was solved analytically by applying a local quasi-steady-state approximation, i.e., aggregates are spatially decomposed into equally sized small spherical shells and the metabolic concentrations are assumed to be homogenous within each shell. Then, the model predicted profiles of heterogeneous metabolite concentrations under steady-state conditions are shown in Fig. 2c and Supplementary Fig. 2. It should be noted that these results were obtained from the single representative aggregate simulation. Clearly, the diffusion of nutrients (i.e., glucose, glutamine, serine) becomes limited as the aggregate radius increases leading to reduced nutrient levels for cells residing closer to the core. For large aggregates, the cells in the inner area are starving due to shortage of glucose, glutamine, and serine. This finding is consistent with the glucose transport limitation in human mesenchymal stem cells reported by Zhong et al. 33 Also, limited diffusion resulted in higher concentration of metabolite wastes and inhibitors 8  (i.e., lactate, ammonium, glutamate) in the aggregates as the size increases. Future investigations of nutrient and metabolic waste levels within aggregates using imaging techniques could provide more evidence.  
Fig. 2 PBM and RDM models to predict iPSC aggregation process in stirred suspension bioreactor cultures. Panel (a) shows the experimental and the predicted aggregate size; Panels (b) shows representative experimental data and PBM predictions of size (radius) distribution for cell aggregates 𝜙%(𝑅,𝑡) at 24, 48 and 72 hr. The dotted orange lines represent the experimental data from Wu et al. 14, while the blue lines show the PBM size distributions. (c) Steady-state concentration profiles of Glucose, Lactate, and Alanine for iPSC aggregates with radii ranging from 60 𝜇m to 600 𝜇m, each with identical values for diffusion coefficients 𝐷&', porosity 𝜀=0.27 and tortuosity 𝜏=1.5 and initial intracellular metabolite concentrations.  Third, the SRN was used to characterizing single-cell metabolism with the backbone mean metabolic reaction rate for homogeneous cell population characterized by the deterministic mechanistic model 30. To support the prediction of iPSC response to micro-environmental perturbations occurring during the aggregate culture process, the SRN model was estimated and validated by using the time-course data of K3 iPSCs cultured in monolayer under high/low nutrient and metabolic waste concentrations as described in Odenwelder et al. 11. Since induced pluripotent stem (iPS) cells cultured in petri-dish 2D monolayer are homogeneous, the deterministic mechanistic model was derived to characterize the expected metabolic flux rate response for cell population in Wang et al. 30. Then, to simulate a monolayer culture, the radii of cell aggregates were set to a uniform 7.5 𝜇m, which corresponds to the single cell radius14. In Fig. 3, the bulk metabolite concentrations predicted from the Bio-SoS for homogeneous iPS cell population is align with both the measured values under a representative high glucose and low lactate experimental condition. As we expected, the simulation results of Bio-SoS closely resemble those of the traditional metabolic flux 
a24 Hours48 Hours72 Hoursbc9  analysis and deterministic mechanistic models when no aggregation and homogeneous cell population is considered.  
 Fig. 3 Comparison of the prediction obtained by using both deterministic mechanistic model30 and the Bio-SoS model on the mean response for monolayer cultures of homogeneous K3 iPS cell population. Monolayer experimental data shown for bulk metabolites (mean±SD). The green lines represent the predicted metabolite concentrations of mechanistic model from Wang et al. 30, the red lines represent the predicted metabolite concentrations of the Bio-SoS model. Blue circles with error bars represent experimental data. The description of metabolite abbreviations is in Supplementary Table 2.  In addition to being able to model the monolayer culture behavior, we sought to further validate the Bio-SoS model on aggregate cultures. As mentioned earlier, the Bio-SoS model was developed and trained by utilizing monolayer culture data from K3 iPSCs11 and cell aggregation profiles from hESCs14. To test its extrapolation prediction performance, we used a collection of aggregate culture data of FSiPS (short for FS hiPSC clone 2) collected from stirred suspension bioreactor from Kwok et al.7 and followed the same culture protocol implemented in Kwok et al.7. To visually compare the measured and predicted glucose consumption and lactate production, we rescaled the vertical axes while keeping the values unchanged and presented the results in Fig. 4. The Bio-SoS model demonstrates good prediction performance on both 
10  glucose and lactate concentrations (represented by the red line) as the predictions are within the 95% confidence intervals of the measured values (represented by the blue error bars). Therefore, the model's prediction using the bioreactor data from FSiPS provides additional confidence in the reliability of the proposed Bio-SoS model. This also suggests its potential for use with other cell lines.  
 Fig. 4 Glucose and lactate concentration profiles predicted by the Bio-SoS model in comparison with the literature data collected from stirred-tank suspension bioreactor. (a) Glucose (b) Lactate. The Bio-SoS model (red line) was trained only with the monolayer data for K3 iPSC described in Odenwelder et al. 11. The experimental data shown (blue circle, Mean±SD) are for FSiPS cultured in aggregate and described in Kwok et al. 7. Note the trends predicted by the Bio-SoS model, which was trained on monolayer data, match the observed trends of aggregate cultures.   Despite the cell line and culture conditions differences between the monolayer training dataset and aggregate cultures, the Bio-SoS model provided meaningful insights into metabolic behaviors. The reliability of extrapolated predictions using the Bio-SoS model is based on key insights included in the model design. First, the underlying metabolic pathways and cellular processes remain relatively consistent across different cell lines and cell types. These simulation results provide clear evidence that the fundamental principles governing cellular metabolism and nutrient utilization persist, even when cells are cultivated under different conditions. By incorporating this fundamental metabolic information into the model, it can capture the core metabolic behaviors and predict metabolic outcomes across different micro-environmental conditions. Second, the model considers the diffusion of metabolites, and accounts for the spatial distribution of nutrients within the culture system. This incorporation allows for a more realistic representation of nutrient availability and metabolic interactions within the aggregates.   a b 11  In-silico Study of iPSC Aggregate Health Conditions Aggregate size influences the transport of nutrients, oxygen, metabolites, and growth factors due to the diffusion of each species, which is related to molecular size and charge. Cells inside large aggregates potentially experience hypoxic conditions and poor nutrient supply due to the limited diffusion of oxygen and nutrients from the bulk media to the center. As a result, the cell growth is reduced. It has already been reported that oxygen concentration in the center region of larger embryoid bodies (EBs) (400 𝜇m in diameter) is 50% lower compared to in medium EBs (200 𝜇m in diameter), which caused apoptosis at the core due to low oxygen diffusion6, 33. Further, low diffusion can limit removal of waste metabolites, such as lactate and ammonia, and increase cell necrosis in the center region as these species reach critical levels.  Previous studies have shown that high lactate concentration can have negative effects on stem cell pluripotency. For example, murine embryonic stem cells (mESCs) and iPSCs proliferated and maintained pluripotency in lactate concentrations up to 40 mM35, while hESCs exhibited decreased pluripotency through Tra-1-60 expression after continuous passaging in 22 mM lactate-containing media36. Ouyang et al. 37 showed that murine embryonic stem cells (mESC) are extremely sensitive to the presence of lactate in media. They inferred that the growth of mESC was inhibited at lactate greater than 16 mM, and that high lactate affected the cell pluripotency. Glucose has also been observed to affect the embryoid body formation potential of mESC when the concentration less than 2.5 mM35. Therefore, in this study, we define cells as being unhealthy if glucose was less than 2.5 mM or lactate was greater than 40 mM.   The Bio-SoS model was used to predict the fraction of unhealthy cells using glucose and lactate concentration criteria (glucose < 2.5 mM or lactate > 40 mM) for aggregates of radius ranging from 30 𝜇m to 600 𝜇m. Fig. 5a shows the percentages of unhealthy cells within an aggregate with a particular radius with varying bulk glucose concentration and a fixed lactate concentration of 0 mM. Notably, all aggregates, regardless of size, exhibited 100% of cells being classified as unhealthy when the bulk glucose concentration fell below 2.5 mM. In contrast, aggregates of radii less than 150 𝜇m, had higher fractions of healthy cells for bulk glucose concentrations greater than 5 mM.  Fig. 5b shows the percentage of unhealthy cells within an aggregate with a particular radius with varying bulk lactate concentration and a fixed glucose concentration of 20 mM. A different pattern was observed for cell health when the bulk lactate concentration changed. The fraction of unhealthy cells increases with the increased aggregate size, and it appears that cells are more sensitive to higher lactate concentrations compared to lower glucose concentrations. 12   Fig. 5 Unhealthy cells as a function of aggregate radius and metabolite concentration. (a) Effect of the glucose concentration and aggregate radius on percentage of unhealthy cells at a fixed bulk lactate concentration of 0 mM. (b) Effect of the lactate concentration and aggregate radius on percentage of unhealthy cells at a fixed bulk glucose concentration of 20 mM. Results are averaged by 30 simulation runs.  In-silico Study of Cell-to-Cell Metabolic Heterogeneity It is well accepted that culture conditions need to remain uniform for optimal iPSC metabolic function and pluripotency maintenance. The formation of large aggregates increases the risk of heterogeneity due to limited diffusion of nutrients and growth factors, and removal of waste metabolites. In order to describe the expected metabolic flux rate response of homogeneous cell population to environmental change, the metabolic regulatory networks were adapted from a companion work by Wang et al30.  Supplementary Fig. 1 shows this metabolic regulatory network, which includes the major metabolic pathways such as glycolysis, TCA cycle, anaplerosis, PPP, and amino acid metabolism. The reactions of PPP were simplified to two reactions (i.e., No. 9 & 10 reaction in Supplementary Table 1) representing the oxidative phase/branch and non-oxidative phase/branch, respectively. The descriptions of metabolites and enzymes are organized according to the Enzyme Commission Numbers (EC-No.) and are listed in Supplementary Table 2 and 3, respectively.  By following the recent studies on stochastic molecular reaction network19, 20, we construct a SMN for single cells that can characterize the stochastic reaction network for individual cells and cell metabolic response to environmental change.  To understand how cell metabolism is affected by the aggregate size and micro-environmental changes, the metabolic reaction intracellular flux rates that are sensitive to the aggregate size are shown in Fig. 6a. Further, the key extracellular metabolite concentrations are shown in Fig. 6b. The flux rates and metabolite a b 13  concentrations were standardized by subtracting the mean and dividing by the standard deviation calculated over all aggregates (see “Method” section). The expected flux rates of the (forward) reactions (e.g., GLNSf and HK) decreased gradually as the aggregate sizes increased, and the flux rate of the reverse reaction (e.g., GLNSr) increased as the aggregate sizes increase. The biomass flux was observed to be relatively high for small aggregates, suggesting such aggregates provide favorable metabolic conditions for biomass production. The reversible reactions such as GLNS, LacT, GLDH, ASTA were affected by the extracellular metabolite concentrations. For example, the flux of LacTr increases in large aggregates due to the high extracellular lactate levels while the fluxes of GLNSr and GLDHr increase due to low-glutamine levels inside large aggregates (Fig. 6b). In summary, these results confirm the importance of maintaining aggregate size for optimal biomass production. It has been observed previously that aggregates exceeding a diameter of 300 𝜇m experience hypoxia and low core nutrient concentrations, resulting in cell necrosis and loss of pluripotency38.  
 Fig. 6 Expected reaction flux rates and extracellular metabolite concentrations by aggregate size. (a) Standardized flux rates. (b) Standardized metabolite concentrations. Simulations were conducted with constant bulk glucose (25 mM), lactate (5 mM), and alanine (0.1 mM) concentrations.  To facilitate visual comparison, all flux rates and concentrations were standardized by subtracting the mean and dividing the standard deviation calculated over all aggregates.  Aggregates range from 30 𝜇m to 600 𝜇m. Results are averaged by 30 simulation runs.  We further investigated the metabolic heterogeneity between inner and outer cells within aggregates of radii ranging from 60 𝜇m to 360 𝜇m (Fig. 7). The blue dashed line depicts the flux rate at the outer cell, while the colored dots represent the relative flux rate of inner cells at various locations. This ratio was calculated as the flux rate of the inner cell relative to the outer cell. Fig. 7 shows the metabolic heterogeneity of the inner cells compared to outer cells for aggregates of various sizes. The greater deviation of larger aggregates a b 14  (represented by purple dots) highlights that they experience greater heterogeneity while the smaller aggregates (represented by orange dots) have more consistent metabolism.  
 Fig. 7 Metabolic heterogeneity of aggregates of varying sizes (60, 120, 240 and 360 𝝁𝐦 in radius) at 24 hours and 48 hours. Specifically, the relative fluxes were compared for cells located at the center of the aggregates of various sizes, called the inner cells. The blue dashed lines represent relative fluxes of outer cells, which were consistent across all four aggregate sizes. The circle (purple) represents the relative flux of the inners cells for the 360 𝜇m aggregates; triangle (red) represents that for 240 𝜇m aggregate; star (green) represents that for 120 𝜇m aggregate; square (orange) represents that for 60 𝜇m aggregate; normalized to the fluxes of outer cells. Results are averaged by 30 simulation runs.  The results in Fig. 7 also show the significant increase in metabolic heterogeneity from 24 to 48 hours, as the greater flux deviations observed in the latter period. This can be attributed to the relative shortage of intracellular metabolites after 48 hours. For example, the 48-hour serine consumption flux (SAL) becomes 
15  more diverse due to low serine, while the poor nutrient supply affected biomass production leading to heterogeneous biomass fluxes (see Supplementary Fig. 1). To quantitatively assess the overall metabolic heterogeneity of each aggregate, the difference between flux rates of the inner and outer cells was calculated (Supplementary Table 5 and 6). Based on the simulation results, the metabolic heterogeneity of a 240-μm aggregate was found to be approximately 14 times greater than that of a 60-μm aggregate. After 48 hours, both aggregate sizes had doubled in metabolic heterogeneity. These simulations demonstrate that metabolic heterogeneity increases with both aggregate size and culture duration.   It is also worth noting that TCA (tricarboxylic acid) cycle has been observed to maintain a stable flux in cell aggregates of different sizes as shown in Fig. 7 (see the reactions highlighted in blue). This observation supports the widely accepted understanding that the TCA cycle is a fundamental housekeeping metabolic pathway (i.e., the flux rate maintains relatively stable in different conditions) 39, and that it is tightly regulated40.   Optimal Aggregate Size An important factor that needs to be strictly controlled in bioreactors is the aggregate size. If iPSC aggregates become too large, uneven diffusion of nutrients and growth factors can occur, causing cell death or heterogeneous cell populations. The optimal aggregate size can be determined by considering the balance between metabolic heterogeneity and biomass yield.   Simulations of a batch bioreactor were performed to calculate the mean and relative standard deviation (RSD) for biomass productivity (Fig. 8a-c) for a 72-hour culture. Supplementary Fig. 3 presents additional simulation results for the mean and RSD of biomass productivity at 6-hour intervals. These results indicated a yield-heterogeneity trade-off, as the mean biomass productivity consistently decreased while the RSDs consistently increased with increased aggregate size. It was also observed that the RSDs consistently increased with the culture time. During the initial 24 hours, the majority of aggregates in the bioreactors exhibited relatively stable biomass productivity (Fig. 8a). The aggregate size distribution (Fig. 2b) indicated that the number of aggregates with a radius greater than 200 𝜇m was very low. This observation implies that the heterogeneity within the cell population is limited early in cultures. However, after 48 hours, the culture entered steady state (as reported previously11, 30). Fig. 8b shows increased heterogeneity of biomass yield for larger aggregates. Notably, there was a distinct cut-off radius of 150 𝜇m after 48-hour 16  culture. For larger radius, the RSD increased significantly faster. These findings suggest the presence of an optimal aggregate size range that minimizes biomass productivity variability and aggregate heterogeneity. Lastly, as Fig. 8c suggests, the biomass productivity decreased significantly as the available nutrients were nearly depleted around 72 hours. Overall, aggregates with a radius below 150 𝜇m had relatively high biomass productivity and a relatively low heterogeneity for 48-hour cultures. These simulation results suggest that iPSC cultures should be maintained as uniform aggregates around 150 𝜇m in radius and should not be greater than 200 𝜇m in radius. This evidence agrees with experiment observations in the literature6, 8, 38.   
 Fig. 8 Biomass yield and variance decomposition analysis. In panel, we simulated the biomass production of different aggregates (ranging from 30 𝜇m to 300 𝜇m in radius) for a duration of one hour with 100 replicates. The recorded results in panels (a), (b) and (c) correspond to 24-hour, 48-hour and 72-hour culture respectively. The blue line represents the mean, and the red line represents the RSD of the biomass (i.e., 𝑅𝑆𝐷(&)*'++,ℓ,- with ℓ=30,45,…,300	from equation (11)).  Discussion The introduction of the Bio-SoS framework marks an important step in the development of multi-scale bioprocess mechanistic model and analytical technology for iPSC cultures. By effectively characterizing cell-to-cell interactions and complex mechanisms of iPSC aggregate culture, the proposed Bio-SoS not only supports data integration and enables the prediction of metabolic dynamics at different scales, but also models spatial heterogeneity and quantifies metabolic intensities and variations across different aggregate locations and time. The model's versatility is shown by its ability to study cell health in different-sized aggregates, predict micro-environmental profile metabolite concentrations under diverse conditions, and determine the optimal aggregate size range and feeding strategy for maximum bioreactor efficiency. Ultimately, the proposed Bio-SoS presents a promising pathway towards low cost and high-quality personalized cell therapies and offers a platform for optimizing large-scale iPSC manufacturing without extensive experiments.  a b c 17   The model validation study demonstrated that the proposed Bio-SoS model has good extrapolation prediction performance. Even though only the monolayer culture data of K3 iPSC with various initial conditions was used, the model was able to predict the metabolic dynamics for a different cell line (FSiPS) cultured in aggregates. This demonstrates the potential for transferring the learning from a monolayer culture to a stirred-suspension culture. From the methodological perspective, this success relies on the proposed biological system-of-systems modelling principle that can organically assemble single-cell model to construct a Bio-SoS model for iPSC aggregate cultures, characterizing cell-to-cell interactions and cell response to spatial heterogeneous micro-environment conditions.   The versatility of the proposed framework is demonstrated by three in-silico scenarios. First, the Bio-SoS model was employed to simulate cell health within aggregates of varying sizes and extracellular metabolite concentrations. These simulation results were able to reproduce the trend observed for experimental findings. Specifically, the model predicted that larger iPSC aggregates would experience hypoxic conditions and poor nutrient supply for inner cells. This stress would then lead to reduced cell growth and increased cell necrosis at the center of the aggregates. Second, the Bio-SoS model was used to investigate the impact of aggregate size on both cell metabolism and micro-environmental heterogeneities. Those simulations provided quantitative insights into the variation of metabolic fluxes across cells at different positions within iPSC aggregates and under varying culture conditions. Third, the Bio-SoS model was used to identify the optimal aggregate size range to maximize efficiency and yield of pluripotent stem cells cultured in a bioreactor. These simulations suggested an ideal aggregate size range is around 150 𝜇m in radius for biomass productivity, which agreed with published reports8, 38.  The system of modules can be a) assembled to facilitate data integration and improve the prediction of monolayer and aggregate cultures; and b) utilized to control cell product quality heterogeneity and optimize the production process performance. Also, the modular design of the Bio-SoS model will facilitate future extensions to incorporate cell responses (i.e., flux rates, phenotype, gene expression) to both mechanical (e.g., stirred speed, hydrodynamic force) and chemical (e.g., concentrations of nutrients/metabolites/oxygen, pH) environmental conditions.    18  Methods  Cell Proliferation and Aggregation Dynamics Modelling The aggregation process is characterized by the dynamic evolution of a density profile of aggregates. Let 𝜙(𝑥,𝑡) denote the average number of aggregates or clusters of size 𝑥 (i.e., mass and volume) at time 𝑡, where mass is equal to a buoyant density times volume. Due to the fact that buoyant density of cells does not vary significantly during the cell cycle, it was assumed the size 𝑥 corresponds either to the volume or mass with the relationship with radius (denoted by 𝑅) 14, i.e., 𝑥∝𝑅.. The important factors impacting on the merge rate of cell aggregates include: (1) mass of aggregates; (2) position or distance of aggregates; and (3) velocity. Therefore, for any cell aggregate with mass 𝑥, the rate at which it merges with another aggregate with mass 𝑥/ is proportional to their densities, i.e., the average number of coalescences, (𝑥,𝑥/)→𝑥+𝑥/, per unit time per unit volume is $0𝜙(𝑥,𝑡)𝜙(𝑥/,𝑡)𝐾(𝑥|𝑥/).  The aggregation kernel, denoted by 𝐾(𝑥|𝑥/), is associated with the average coalescence or merge rate of cell aggregates with mass 𝑥 and 𝑥/. In this work, only a purely coalescing process was considered where the merge rate was only dependent on the size of aggregates,  𝐾(𝑥|𝑥/)=𝑘⋅expJ−𝑘$J𝑥+𝑥/2	L'LM𝑥$.+𝑥/$.	N73	𝑤𝑖𝑡ℎ	𝑐𝑜𝑛𝑠𝑡𝑎𝑛𝑡𝑠	𝑘,𝑘$,𝑎>0.(1) The exponential part in equation (1) accounts for the fact that there is the decreasing coalescence efficiency as the aggregate size increases14. The part W𝑥!"+𝑥/!"	X#" accounts for the fact that the collisions of these aggregates and the shear induced by micro-fluids with nonlinear velocity profile through a pore network within each cell cluster can lead to film drainage. It involves the draining of the film surrounding the interactive aggregates to permit actual coalescence of aggregates with size 𝑥 and 𝑥/. The effects from other factors are lumped into the constant 𝑘 of the model. In general, except aggregate size, the merge rate should be a function of other factors, such as agitation speed and medium compositions. The cell-to-cell and cell-to-medium interactions influence the aggregation process and the design of the kernel 𝐾(⋅). This falls outside the scope of this paper but is a subject for future work. The kernel parameters (𝑘=1.26×10#. hr-1𝜇m#2/.	, 𝑘$=1.94×10#4	𝜇m#.', 𝑎=8.06×10#$) are adapted from Wu et al. 14.  The break-up effects of aggregates were considered negligible and the profile 𝜙(𝑥,𝑡) evolves through coalescence events only. A population balance model (PBM) is employed to simulate the temporal 19  evolution of size of the aggregates accounting for cell proliferation contributions and collisions between particles to aggregate size growth14, 41, 42. The temporal evolution of cell aggregate profile becomes, 𝜕𝜙(𝑥,𝑡)𝜕𝑡=12^𝜙(𝑥5,𝑡)𝜙(𝑥/,𝑡)𝐾(𝑥5|𝑥/)𝑑𝑥/66$−^𝜙(𝑥,𝑡)𝜙(𝑥/,𝑡)𝐾(𝑥|𝑥/)𝑑𝑥/76$−𝜕`𝜙(𝑥,𝑡)𝜕𝑥𝜕𝑡a𝜕𝑥,(2) where the density function  𝜙(𝑥,𝑡) is defined such that 𝜙(𝑥,𝑡)𝑑𝑥 is the fraction of aggregates with sizes between 𝑥 and 𝑥+𝑑𝑥 at time 𝑡 per unit volume of the culture. Let 𝑥8 denote the size of a single cell. The first and second terms on the right side of equation (2) coming from the Smoluchowski coagulation equation, accounting for random coalescence.  The first term describes the formation of aggregates with size 𝑥/ due to the aggregation of cell clusters with size 𝑥/>𝑥8 and 𝑥5=𝑥−𝑥/. The last two terms represent the “loss” of aggregate with size 𝑥 due to their merging with those of size 𝑥/ to form larger aggregates and due to cell proliferation 𝜕𝑥/𝜕𝑡.  Following Wu et al. 14, the rate of aggregate size was modelled by the change 𝜕𝑥/𝜕𝑡 due to cell proliferation by Gompertz equation42: 𝜕𝑥𝜕𝑡=𝛼9⋅𝑥logM𝑀𝑥N where 𝑀 is the aggregate size reached as 𝑡→∞ and 𝛼9 is a constant characterizing the cell proliferation. The Gompertz equation parameters (𝑀	=	9.71×10: and 𝛼9=	5.72×10#. hr -1) are adapted from Wu et al. 14. Based on the iPSC culture data utilized in this study, the shrinking of iPSC aggregates has not been observed. If the experimental observation indicates the cell death impact, our model can be extended to account for the shrinking of the iPSC aggregates due to the cell death.  The transformation of the density function from aggregate size 𝑥 to aggregate radius 𝑅 can be done with the rule of transformation of random variables. For the strictly monotone transformation 𝑓:𝑅↦𝑥!" and its inverse 𝑥=𝑓#$(𝑅)=𝑅. the probability density function of the aggregate radius, denoted by 𝜙%(𝑅,𝑡), is given by, 𝜙%(𝑅,𝑡)=𝜙l𝑓#$(𝑅)mn𝑑𝑓#$(𝑅)𝑑𝑅n=2𝜙(𝑅.,𝑡)𝑅0. 20  The first moments of the cell distribution yield the total aggregate size (accounting for the aggregate porosity 𝜀), 	𝑀$(𝑡)=(1−𝜀)∫𝑥𝜙(𝑥,𝑡)𝑑𝑥76$. Since the size of each cell is 𝑥8, the average number of cells in each aggregate is given by 𝑧;<===𝑀$(𝑡)/𝑥8. Let 𝑋 denotes the cell density and 𝑉 is the volume. We can further calculate the total number of aggregates as 𝑧-)-'==𝑋𝑉/𝑧;<== and aggregate density (aggregate count per unit of volume) as 𝑧><"+&-?=𝑋/𝑧;<==.   Because the system comprises aggregates of multiple sizes, cell aggregates were classified into 𝐿 groups. The radius of each ℓ-th group with ℓ=1,2,…,𝐿 is between 𝑅ℓ#$ and 𝑅ℓ. Remember that 𝑅8 is the radius of a single cell. Thus, the cell aggregate density (aggregates/L) in the ℓ-th group is, 𝑀ℓ(𝑡)=𝑧><"+&-?^𝜙%(𝑅,𝑡)𝑑𝑅,%ℓ%ℓ&!		ℓ=1,2,…,𝐿.(3)  Reaction-Diffusion Model The reaction-diffusion model provides a means of characterizing cell-to-cell interactions and quantifying the spatial heterogeneity in micro-environment conditions, by modelling the dynamic change of spatial and temporal concentration profiles of crucial components such as nutrients and metabolites like glucose and lactate. Suppose that the aggregates have cell spheres.  A cluster of cells in a liquid medium was considered and assumed to have uniform diffusion in all directions along the radial axis. Let 𝑠=l𝑠$,…,𝑠"'m denote the spatial profile of intracellular metabolite concentrations for species 𝑖=1,2,…,𝑛+ at time 𝑡 and located at radius 𝑟. Let 𝑐=l𝑐$,…,𝑐"'m denote the spatial profile of concentration of each extracellular species 𝑖=1,2,…,𝑛; at time 𝑡 and located at radius 𝑟.  The concentration of the 𝑖-th species at time 𝑡 and located at aggregate radius 𝑟, denoted by 𝑐&(𝑟,𝑡), satisfies the set of reaction-diffusion equations in spherical coordinate with boundary conditions, i.e., 𝜕𝑐&𝜕𝑡=𝐷&𝑟0𝜕𝜕𝑟M𝑟0𝜕𝑐&𝜕𝑟N+𝜌&(𝑐,𝑠)	(4) subject	to	boundary	conditions:	(𝑎)	𝑐&(𝑅,𝑡)=𝑢&(𝑡)	𝑎𝑛𝑑	(𝑏)	𝜕𝑐(0,𝑡)𝜕𝑟=0 21  where 𝐷& is the effective diffusion coefficient, 𝑢&(𝑡) is the extra-aggregate environment conditions (e.g., the bulk concentrations of glucose and lactate in the bioreactor), and 𝑅 is the aggregate size. Here the reaction rate 𝜌& is negative for nutrient consumption and positive for inhibitor formulation. The boundary condition (a) comes from the fact that the metabolite concentration on the surface of an aggregate equals to that measured in the bioreactor; and (b) is produced by the condition of spherical symmetry.  Due to the reaction and diffusion, the metabolite concentrations at different locations or depth of a cell aggregate are different. We divide each aggregate of radius 𝑅ℓ into 𝑁ℓ spherical shells (shaped like a 3D annulus or “rings”) and assume that the cellular metabolisms are homogeneous in each spherical shell. The 𝑛-th spherical shell of the ℓ-th aggregate is located between the radii between 𝑅ℓ"#$ and 𝑅ℓ"; see the illustration in Fig. 1b. The volume of the spherical shell	is the difference between the enclosed volume of the outer sphere and the enclosed volume of the inner sphere: 4@.W𝑅ℓ(")X.−4@.W𝑅ℓ("#$)X..  Quasi-steady-state solution in radial cases of 𝒄𝒊(𝒓,𝒕). It is challenging to directly solve the transient reaction-diffusion equation (4). Thus, a similar approach as that used in McMurtrey44 was applied to account for the quasi-steady-state setting, i.e., D;(D-=0. A quasi-steady-state solution of reaction-diffusion model is widely used in cell aggregation literature44, 45 to describe the metabolite diffusion inside an aggregate. In each 𝑛-th spherical shell, the extracellular concentration profile or micro-environmental condition can be solved analytically44 as the nutrient consumption or inhibitor formulation rates 𝜌&(𝑐,𝑠)  are constant in the spherical shell specified by [𝑅ℓ"#$,𝑅ℓ"]: 𝑐&(𝑟,𝑡)=16𝜌&(ℓ,",-)𝐷&W𝑅ℓ(")0−𝑟0X+𝑢&(ℓ,",-)	with	𝑟∈𝑅ℓ"#$,𝑅ℓ"(5) where 𝜌&(ℓ,",-) is the consumption/formulation rate of metabolite 𝑊& in the 𝑛-th spherical shell of the ℓ-th aggregate and 𝑢&(ℓ,",-) denotes the the boundary condition of metabolite 𝑊& in the 𝑛-th spherical shell of the ℓ-th aggregate at time 𝑡. The formulation/consumption rate 𝜌&(ℓ,",-) depends on the intracellular metabolism of cells located in the 𝑛-th spherical shell of the ℓ-th aggregate and its mathematical formulation will be discussed in the next section.   22  Here, 𝐷& is the effective diffusion coefficient of the 𝑖-th species. Given the porosity 𝜀 and tortuosity 𝜏, it is calculated as 𝐷&=EF⋅𝐷&', where 𝐷&' is the diffusion coefficient of the 𝑖-th species in aqueous condition. In a 4-day culture in spinner flasks at the agitation rate of 60 rpm, the porosity and tortuosity of hESC aggregates were reported to be 0.270 ± 0.007 unitless and 1.551 ± 0.086 unitless, respectively14. Since the metabolites are transported between the outer spherical shell and extra-aggregate environment, the boundary condition for the 𝑁ℓ-th spherical shell is given by 𝑢&(ℓ,Gℓ,-)=𝑢&(𝑡). Further, metabolites are freely transported between spherical shells and thus the metabolite concentrations on the outer surface of the (𝑛−1)-th spherical shell equal to the concentrations on the inner surface of the 𝑛-th spherical shell, i.e., mathematically, 𝑢&(ℓ,"#$,-)=𝑐&W𝑅ℓ("),𝑡X. The solution in equation (5) illustrates that: (a) the nutrient concentrations, increasing from aggregate center to the surface, becomes highest on the surface 𝑐(𝑅,𝑡)=𝑢&(𝑡); and (b) the metabolite waste concentrations, decreasing from center to surface, is highest at the center 𝑐(0,𝑡)=𝑢&(𝑡)+$:∑𝜌&(ℓ,",-)𝐷&MW𝑅ℓ(")X0−W𝑅ℓ("#$)X0NGℓ"H$.  Estimating reaction rate 𝜌& in reaction-diffusion model. Conceptually the reaction rate 𝜌& (nmol/(𝜇m.⋅ℎ)) of the metabolite 𝑊& is the weighted sum of the associated flux rates (nmol/ 10: cells/h). Thus, putting all in vectors, we have 𝜌=𝑁⋅𝑣⋅𝛾 where 𝑁 represents the stoichiometric matrix, 𝑣 is the flux rate vector, and 𝛾 is a unit conversion factor. By assuming the averaged single cell radius to be 7.5 𝜇m, the average cell volume can be estimated by 𝐴=𝜀⋅4@.×7.5. (𝜇m./cell) with porosity 𝜀. Then 1 nmol/10: cells/h of flux rate can be converted to the reaction rate of γ≝$	IJKL/$8)	MNLLO/PQ=.×$8)4@E×2.T"𝜇m.⋅ℎ.  Stochastic Metabolic Reaction Network Model for Single-Cell For each iPSC, let us consider a metabolic network system with 𝑛 species (𝑊$,𝑊0,…,𝑊") which interact with each other through 𝑘 chemical reactions. Let 𝑢&(𝑡)	denote the number of molecules of metabolite 𝑊& in an individual cell at time 𝑡. Denote the vector 𝒖=(𝑢$,𝑢0,…,𝑢"). Here 𝒖 includes both intracellular and extracellular metabolites, i.e.,  𝒖=(𝒔,𝒄). The metabolic reaction network can be expressed as46 23  𝜂&U	𝑊&V*→"&H$𝜂&U/	𝑊&"&H$,𝑗=1,2,…,𝑘(5) where 𝜂&U and 𝜂&U/ are nonnegative integers. Let 𝜼U	be the vector whose 𝑖-th component is 𝜂&U representing the number of molecules of the 𝑖-th metabolite consumed in the 𝑗-th reaction. Let 𝜼U/ be the vector whose 𝑖-th component is 𝜂&U/ representing the number of molecules of the 𝑖-th metabolite produced by the 𝑗-th reaction. By writing them in matrix form, i.e., 𝜼=(𝜼$,…,𝜼W) and 𝜼/=(𝜼$/,…,𝜼W/), we define the stoichiometric matrix as 𝑁=𝜼/−𝜼. Let 𝑣U(𝒖) be the flux rate at which the 𝑗-th reaction occurs for an individual cell, that is, the propensity/intensity of the 𝑗-th reaction as a function of the number of molecules of metabolites. Later on, we will show that the rate  𝑣U(𝒖) is a generalized flux rate, analogous to that of the metabolic flux analysis (MFA).  Let 𝑅(𝑡) be the 𝑘-dimensional vector whose 𝑗-th component is 𝑅U(𝑡), representing the number of times the 𝑗-th molecular reaction has occurred by time 𝑡 in a single cell. Thus, at time 𝑡, the profile of intracellular and extracellular metabolite molecules follows the dynamics, i.e., 𝒖(𝑡)=𝒖(0)+𝑅U(𝑡)l𝜼U/−𝜼Um=𝒖(0)+𝑁⋅𝑅(𝑡)WUH$.(6) Equation (6) is a mass balance equation where  𝒖(𝑡)−𝒖(0) is the difference of number of molecules in time interval [0,𝑡] and 𝑁⋅𝑅(𝑡) is the net amount of reaction output by time 𝑡. The number of occurrences of the 𝑗-th molecular reaction, 𝑅U(𝑡+d𝑡)−𝑅U(𝑡), during time interval [𝑡,𝑡+d𝑡] is modelled as a Poisson random variable with mean (and variance) 𝑣Ul𝒖(𝑡)md𝑡 and 𝑅U(𝑡) follows a nonhomogeneous Poisson process with the flux rate or molecule generation rate 𝑣Ul𝒖(𝑡)m17, 20, 46.  Based on the definition of Poisson process, during the time interval	(𝑡,𝑡+d𝑡], the probability that the 𝑗-th reaction occurs 𝑛 times becomes46 	Pl𝑅U(𝑡+d𝑡)−𝑅U(	𝑡)=𝑛m=𝑒#∫V*Y𝒖[(6)\]6+,-++W∫𝑣Ul𝒖(𝑥)m-^]--d𝑥X"𝑛!≝𝑃𝑜𝑖𝑠𝑠𝑜𝑛J^𝑣Ul𝒖(𝜏)m-^]--d𝜏L(9) 24  Define the expected accumulated occurrences of the 𝑗-th molecular reaction by time t, i.e., ΛU(𝑡)=∫𝑣Ul𝒖(𝜏)m-8d𝜏. Equation (9) can be rewritten as 𝑅U(𝑡)=𝑌WΛU(𝑡)X, where 𝑌(𝑡) is a unit (or rate one) Poisson process. Let 𝑅(𝑡)=W𝑌lΛ$(𝑡)m,…,𝑌lΛW(𝑡)mX, then equation (6) becomes, 𝒖(𝑡)=𝒖(0)+𝑌WΛU(𝑡)Xl𝜼U/−𝜼UmWUH$.(10)  Bio-SoS Mechanistic Model for iPSC Aggregate Culture By assembling the single-cell metabolic network with population balance and reaction-diffusion models, we developed the Bio-SoS characterizing the dynamics of iPSC aggregate culture with either homogeneous or non-homogeneous cell population. Since cells create the driving force for the dynamics of the culture process, we focus on modelling the evolution of cell metabolic dynamics and associated microenvironmental conditions. Let 𝑋 denote the cell density, i.e., number of cells per unit of volume. Let 𝒖((𝑡) denote the number of molecules of metabolites within and “around” each 𝑏-th cell with 𝑏=1,2,…,𝑋.  First, the homogeneous cell population is assumed. Let 𝒖(t,𝑋)=∑𝒖((𝑡)_(H$ denote metabolite concentrations (i.e., the number of molecules of metabolites per unit of volume) in the system at time 𝑡. Given a cell density 𝑋(𝑡) (i.e., the number of cells per unit of volume), the change in the number of metabolite molecules during the short time interval	(𝑡,𝑡+d𝑡] is obtained by summing the changes from each cell, i.e.,  Δ𝒖(𝑡,𝑋)≡𝒖(𝑡+Δ𝑡,𝑋)−𝒖(𝑡,𝑋)=[𝒖((𝑡+Δ𝑡)−	𝒖((𝑡)]_(H$=𝑌J^𝑣Ul𝒖((𝜏)m𝑑𝜏-^`--Ll𝜼U/−𝜼UmWUH$_(H$=𝑌J𝑋^𝑣Ul[𝒖(	(𝜏)m𝑑𝜏-^`--Ll𝜼U/−𝜼Um.WUH$(7) When the flux rate is constant 𝑣Ul𝒖((𝑡)m=𝑣U, the dynamics of expected metabolite concentration is the same as dynamic flux balance model15, 48 (see “Supplementary Methods”). Thus, the deterministic ODE-25  based metabolic model can be interpreted as a special case of the stochastic reaction model with mean metabolite concentrations and constant flux rates, ignoring cell-to-cell variation.  Second, the heterogeneous cell population is considered. Let 𝑢&(𝑡) denote the concentration of metabolite 𝑊& (i.e., the number of molecules per unit of volume) in the system at time 𝑡. Here the metabolite concentrations include both intracellular and extracellular metabolites, i.e., 𝒖=(𝒔,𝒄). Recall that the cell aggregates were divided to 𝐿 groups with different size. Each aggregate is divided to 𝑁ℓ spherical shells with 𝒄(𝑅ℓ",t) and 𝒔(𝑅ℓ",t) representing the concentrations of extracellular (within aggregate) and intracellular metabolites in the ℓ-th aggregate at the radius of 𝑅ℓ" at time 𝑡. Thus, the cell density (i.e., the cell number per unit of volume) in the 𝑛-th spherical shell of the ℓ-th aggregate group at time 𝑡 can be computed based on the aggregate density and the number of cells in that spherical shell, i.e., 	𝐺ℓ(")(𝑡)=𝑀ℓ(𝑡)(1−𝜀)W𝑅ℓ(")X.−W𝑅ℓ("#$)X.𝑅8. where the aggregate density 𝑀ℓ(𝑡) (equation (3)) was obtained by solving the population balance model.  Then, for each 𝑗-th reaction, the overall flux rate of all cells in a unit of volume residing in the spherical shell ¤𝑅ℓ("#$),𝑅ℓ(")¥ at time 𝑡 (denoted by 𝑣̅U(ℓ,",-)) is given by the product of the cell density 𝐺ℓ(") and single-cell flux rate 𝑣U(ℓ,",-)=𝑣UM𝒄W𝑅ℓ("),𝑡X,𝒔W𝑅ℓ("),𝑡XN in the shell, i.e.,  𝑣̅U(ℓ,",-)=𝐺ℓ(")(𝑡)𝑣U(ℓ,",-). Recall that 𝑐W𝑅ℓ("),𝑡X can be obtained by solving the reaction-diffusion model (see “Methods” section).   After that, we can divide the culture time [0,𝑡] into G equally spaced intervals [(𝑔−1)Δ𝑡,𝑔Δ𝑡] with 𝑔=1,2,…,𝐺, and numerically compute the metabolite concentrations 𝒖(t) as 	𝒖(𝑡)≈	𝒖(0)+𝑌W𝑣̅U(ℓ,",(a#$)`-)Δ𝑡XWUH$9aH$Gℓ"H$bℓH$l𝜼U/−𝜼Um	where 𝒖(0) is the initial concentrations. 26   Variance Decomposition Analysis Stem cells, such as iPS cells, that proliferate in the culture process can undergo considerable variation in metabolic reaction rates due to the change in specific environmental conditions. To better understand the metabolic heterogeneity of stem cell culture and identifies sources of uncertainty, we developed a variance decomposition method based on the Bio-SoS model. It can be used to explain how the variance measuring the metabolic heterogeneity is contributed by different sized cell aggregates and how the variance is spatially distributed within each cell aggregate. • Single Aggregate: Let ∑𝑌W𝑣̅U(ℓ,",-)Δ𝑡XWUH$(𝜂&U/−𝜂&U	) represent the concentration change of metabolite 𝑊& due to the reactions occurred in cells located in the 𝑛-th spherical shell of the ℓ-th aggregate during time interval (𝑡,𝑡+d𝑡]. Then, the total variance of the metabolite 𝑊& in an individual aggregate, denoted by 𝜎&,ℓ,-0, can be expressed by 𝜎&,ℓ,-0=𝑉𝑎𝑟ªΔ𝑢&(ℓ,",-)Gℓ"H$«=𝑉𝑎𝑟¬𝑌W𝑣̅U(ℓ,",-)XWUH$l𝜼&U/−𝜼&UmGℓ"H$­. Relative standard deviation (RSD) is a statistical measurement that describes the spread of data with respect to the mean. The RSD of metabolite 𝑊& in each ℓ-th cell aggregate at time 𝑡 is expressed by 𝑅𝑆𝐷&,ℓ,-	=𝜎&,ℓ,-𝜇&,ℓ,-		with		𝜇&,ℓ,-=	𝔼`Δ𝑢&(ℓ,",-)Gℓ"H$a.(11) • Cell Population Heterogeneity: Given well-controlled bulk bioreactor conditions, we suppose the independence of different aggregates.  During the time interval (𝑡,𝑡+d𝑡], the total variance of the metabolite 𝑊& concentration change in the bio-system, denoted by 𝜎&,-0, can be divided into the contribution from each ℓ-th group of aggregates with radius 𝑅ℓ, i.e.,  𝜎&,-0=𝑉𝑎𝑟¬𝑌W𝑣̅U(ℓ,",-)Δ𝑡XWUH$l𝜼&U/−𝜼&UmGℓ"H$bℓH$­=𝜎&,ℓ,-.0bℓH$  This study can support the analysis and provide the insights on both metabolic heterogeneity and spatial heterogeneity. The metabolic heterogeneity can be assessed through studying the relative changes of metabolic fluxes for cells residing at different locations and time within an aggregate as shown in Fig. 7. 27  At the same time, the impact of spatial heterogeneity can be investigated through measuring the contribution of (biomass) output variance from the cell aggregates with different radius size as illustrated in Fig. 8.  This can guide the selection of optimal aggregate size to maximize the expected yield and control the output variance.  Flux and Metabolite Standardization Standardization of the flux rates and metabolite concentrations used was performed in three steps: (1) the average fluxes and metabolite concentrations were calculated for each ℓ-th group of aggregates with radius 𝑅ℓ ranging from 30 to 600 𝜇m; (2) the means and standard deviations of those fluxes and concentrations over all aggregates were computed; and (3) for each flux or metabolite concentration, the mean value was subtracted and the result was divided by the corresponding standard deviation. For example, the average flux of the 𝑗-th reaction in the ℓ-th group of aggregates is given by 	𝑣̅U(ℓ,⋅,-)=$Gℓ∑	𝑣̅U(ℓ,",-)Gℓ"H$ and the standardization of this within-aggregate flux is performed by  StandardizationW	𝑣̅U(ℓ,⋅,-)X=	𝑣̅U(ℓ,⋅,-)−𝑣̅U(⋅,⋅,-)±∑W𝑣̅U(ℓ,⋅,-)−𝑣̅U(⋅,⋅,-)X0bℓH$𝐿−1 where 𝑣̅U(⋅,⋅,-)=$b∑	𝑣̅U(ℓ,⋅,-)bℓH$.  Statistics and reproducibility The details about sample sizes, parameters and steps of statistical analysis are provided in relevant methods and results sections, figure legends, and tables where applicable. All statistical analysis is performed in Python.  Data Availability The data used in this work are collected from open-access databases. The monolayer iPSC cell culture data are in Supplementary Data11. The bioreactor iPSC culture data are from Kwok et al. 7. The parameters of 28  population balance model are adapted from Wu et al. 14. The diffusion coefficients are from multiple published sources49, 50, 51, 52, 53, 54, 55.  References  1. Chen KG, Mallon BS, McKay RD, Robey PG. Human pluripotent stem cell culture: considerations for maintenance, expansion, and therapeutics. Cell stem cell 14, 13-26 (2014).  2. Liu G, David BT, Trawczynski M, Fessler RG. Advances in pluripotent stem cells: history, mechanisms, technologies, and applications. Stem cell reviews and reports 16, 3-32 (2020).  3. Borys BS, et al. Optimized serial expansion of human induced pluripotent stem cells using low-density inoculation to generate clinically relevant quantities in vertical-wheel bioreactors. Stem Cells Translational Medicine 9, 1036-1052 (2020).  4. Meng G, Liu S, Poon A, Rancourt DE. Optimizing human induced pluripotent stem cell expansion in stirred-suspension culture. Stem cells and development 26, 1804-1817 (2017).  5. Kinney MA, Sargent CY, McDevitt TC. The multiparametric effects of hydrodynamic environments on stem cell culture. Tissue Engineering Part B: Reviews 17,  (2011).  6. Van Winkle AP, Gates ID, Kallos MS. Mass transfer limitations in embryoid bodies during human embryonic stem cell differentiation. Cells Tissues Organs 196, 34-47 (2012).  7. Kwok CK, et al. Scalable stirred suspension culture for the generation of billions of human induced pluripotent stem cells using single‐use bioreactors. Journal of tissue engineering and regenerative medicine 12, e1076-e1087 (2018).  29  8. Lee B, Borys BS, Kallos MS, Rodrigues CA, Silva TP, Cabral JM. Challenges and solutions for commercial scale manufacturing of allogeneic pluripotent stem cell products. Bioengineering 7, 31 (2020).  9. Galvanauskas V, Simutis R, Nath SC, Kino-Oka M. Kinetic modeling of human induced pluripotent stem cell expansion in suspension culture. Regenerative therapy 12, 88-93 (2019).  10. Bartolini E, et al. Population balance modelling of stem cell culture in 3D suspension bioreactors. Chemical Engineering Research and Design 101, 125-134 (2015).  11. Odenwelder DC, Lu X, Harcum SW. Induced pluripotent stem cells can utilize lactate as a metabolic substrate to support proliferation. Biotechnology Progress 37, e3090 (2021).  12. Stephanopoulos G. Metabolic fluxes and metabolic engineering. Metab Eng 1, 1-11 (1999).  13. Antoniewicz MR, Kelleher JK, Stephanopoulos G. Elementary metabolite units (EMU): a novel framework for modeling isotopic distributions. Metab Eng 9, 68-86 (2007).  14. Wu J, Rostami MR, Cadavid Olaya DP, Tzanakakis ES. Oxygen transport and stem cell aggregation in stirred-suspension bioreactor cultures. PLoS One 9, e102486 (2014).  15. Kauffman KJ, Prakash P, Edwards JS. Advances in flux balance analysis. Curr Opin Biotechnol 14, 491-496 (2003).  16. Kyriakopoulos S, et al. Kinetic Modeling of Mammalian Cell Culture Bioprocessing: The Quest to Advance Biomanufacturing. Biotechnol J 13, e1700229 (2018).  17. Gillespie DT. Stochastic simulation of chemical kinetics. Annu Rev Phys Chem 58, 35-55 (2007).  30  18. Lecca P. Stochastic chemical kinetics : A review of the modelling and simulation approaches. Biophys Rev 5, 323-345 (2013).  19. Hochendoner P, Ogle C, Mather WH. A queueing approach to multi-site enzyme kinetics. Interface Focus 4, 20130077 (2014).  20. Kloska S, et al. Queueing theory model of Krebs cycle. Bioinformatics 37, 2912-2919 (2021).  21. Arnol, D., Schapiro, D., Bodenmiller, B., Saez-Rodriguez, J., & Stegle, O. (2019). Modeling cell-cell interactions from spatial molecular data with spatial variance component analysis. Cell Rep., 29, 202-211.Deisboeck TS, Wang Z, Macklin P, Cristini V. Multiscale cancer modeling. Annu Rev Biomed Eng 13, 127-155 (2011).  22. Deisboeck TS, Wang Z, Macklin P, Cristini V. Multiscale cancer modeling. Annu Rev Biomed Eng 13, 127-155 (2011).  23. Wang Z, Butner JD, Kerketta R, Cristini V, Deisboeck TS. Simulating cancer growth with multiscale agent-based modeling. Semin Cancer Biol 30, 70-78 (2015).  24. Bocci F, Suzuki Y, Lu M, Onuchic JN. Role of metabolic spatiotemporal dynamics in regulating biofilm colony expansion. Proc Natl Acad Sci U S A 115, 4288-4293 (2018).  25. Ghaffarizadeh A, Heiland R, Friedman SH, Mumenthaler SM, Macklin P. PhysiCell: An open source physics-based cell simulator for 3-D multicellular systems. PLoS Comput Biol 14, e1005991 (2018).  26. Cooper FR, et al. Chaste: Cancer, Heart and Soft Tissue Environment. J Open Source Softw 5, 1848 (2020).  31  27. Johnson CGM, Fletcher AG, Soyer OS. ChemChaste: Simulating spatially inhomogeneous biochemical reaction-diffusion systems for modeling cell-environment feedbacks. Gigascience 11,  (2022).  28. Palmer BJ, Almgren AS, Johnson CGM, Myers AT, Cannon WR. BMX: Biological modelling and interface exchange. Scientific Reports 13, 12235 (2023).  29. Starruss J, de Back W, Brusch L, Deutsch A. Morpheus: a user-friendly modeling environment for multiscale and multicellular systems biology. Bioinformatics 30, 1331-1332 (2014).  30. Wang K, Xie W, Harcum SW. Metabolic Regulatory Network Kinetic Modeling with Multiple Isotopic Tracers for iPSCs. arXiv preprint arXiv:230500165,  (2023).  31. Kumar S, Ramkrishna D. On the solution of population balance equations by discretization—II. A moving pivot technique. Chemical Engineering Science 51, 1333-1342 (1996).  32. Xie AW, et al. Controlled self-assembly of stem cell aggregates instructs pluripotency and lineage bias. Scientific reports 7, 14070 (2017).  33. Zhong Y, Motavalli M, Wang K-C, Caplan AI, Welter JF, Baskaran H. Dynamics of intrinsic glucose uptake kinetics in human mesenchymal stem cells during chondrogenesis. Annals of biomedical engineering 46, 1896-1910 (2018).  34. Nath SC, Horie M, Nagamori E, Kino-Oka M. Size- and time-dependent growth properties of human induced pluripotent stem cells in the culture of single aggregate. J Biosci Bioeng 124, 469-475 (2017).  35. Chaudhry MA, Bowen BD, Piret JM. Culture pH and osmolality influence proliferation and embryoid body yields of murine embryonic stem cells. Biochemical Engineering Journal 45, 126-135 (2009). 32   36. Chen X, Chen A, Woo TL, Choo ABH, Reuveny S, Oh SKW. Investigations into the Metabolism of Two-Dimensional Colony and Suspended Microcarrier Cultures of Human Embryonic Stem Cells in Serum-Free Media. Stem Cells and Development 19, 1781-1792 (2010).  37. Ouyang A, Ng R, Yang S-T. Long-Term Culturing of Undifferentiated Embryonic Stem Cells in Conditioned Media and Three-Dimensional Fibrous Matrices Without Extracellular Matrix Coating. Stem Cells 25, 447-454 (2006).  38. Sen A, Kallos MS, Behie LA. Effects of Hydrodynamics on Cultures of Mammalian Neural Stem Cell Aggregates in Suspension Bioreactors. Industrial & Engineering Chemistry Research 40, 5350-5357 (2001).  39. Scagliola A, Mainini F, Cardaci S. The tricarboxylic acid cycle at the crossroad between cancer and immunity. Antioxidants & Redox Signaling 32, 834-852 (2020).  40. Martinez-Reyes I, Chandel NS. Mitochondrial TCA cycle metabolites control physiology and disease. Nat Commun 11, 102 (2020).  41. Kehoe DE, Jing D, Lock LT, Tzanakakis ES. Scalable stirred-suspension bioreactor culture of human pluripotent stem cells. Tissue Eng Part A 16, 405-421 (2010).  42. Ramkrishna D, Singh MR. Population balance modeling: current status and future prospects. Annu Rev Chem Biomol Eng 5, 123-146 (2014).  43. Brunton GF, Wheldon TE. The Gompertz equation and the construction of tumour growth curves. Cell Tissue Kinet 13, 455-460 (1980).  44. McMurtrey RJ. Analytic Models of Oxygen and Nutrient Diffusion, Metabolism Dynamics, and Architecture Optimization in Three-Dimensional Tissue Constructs with Applications and Insights in Cerebral Organoids. Tissue Eng Part C Methods 22, 221-249 (2016). 33   45. Guo Y, Nitzan M, Brenner MP. Programming cell growth into different cluster shapes using diffusible signals. PLOS Computational Biology 17, e1009576 (2021).  46. Anderson DF, Kurtz TG. Continuous Time Markov Chain Models for Chemical Reaction Networks. In: Design and Analysis of Biomolecular Circuits: Engineering Approaches to Systems and Synthetic Biology (eds Koeppl H, Setti G, di Bernardo M, Densmore D). Springer New York (2011).  47. Gallager RG. Stochastic processes: theory for applications. Cambridge University Press (2013).  48. Henson MA, Hanly TJ. Dynamic flux balance analysis for synthetic microbial communities. IET Syst Biol 8, 214-229 (2014).  49. Koelsch BL, Keshari KR, Peeters TH, Larson PE, Wilson DM, Kurhanewicz J. Diffusion MR of hyperpolarized 13C molecules in solution. Analyst 138, 1011-1014 (2013).  50. Ma Y, Zhu C, Ma P, Yu KT. Studies on the Diffusion Coefficients of Amino Acids in Aqueous Solutions. Journal of Chemical & Engineering Data 50, 1192-1196 (2005).  51. Stein WD, Litman T. Channels, carriers, and pumps: an introduction to membrane transport. Elsevier (2014).  52. Longsworth LG. Diffusion Measurements, at 25°, of Aqueous Solutions of Amino Acids, Peptides and Sugars. Journal of the American Chemical Society 75, 5705-5709 (1953).  53. Ribeiro ACF, Barros MCF, Verissimo LMP, Lobo VMM, Valente AJM. Binary Diffusion Coefficients for Aqueous Solutions of l-Aspartic Acid and Its Respective Monosodium Salt. Journal of Solution Chemistry 43, 83-92 (2014).  34  54. Ribeiro ACF, et al. Mutual diffusion coefficients of L-glutamic acid and monosodium L-glutamate in aqueous solutions at T=298.15K. The Journal of Chemical Thermodynamics 74, 133-137 (2014).  55. Kreft JU, Picioreanu C, Wimpenny JW, van Loosdrecht MC. Individual-based modelling of biofilms. Microbiology (Reading) 147, 2897-2912 (2001).   35  Supplementary Methods Proposition 1 Under the homogeneous population condition, the expected metabolite concentrations are 𝑑𝔼[𝒖(𝑡,𝑋)|𝑋]𝑑𝑡=𝑁𝑑𝔼[𝚲(𝑡)]𝑑𝑡𝑋	(S.1) where 𝚲(𝑡)	=lΛ$(𝑡),Λ0(𝑡),…,ΛW(𝑡)m. Proof. Taking the difference of metabolite concentration (equation (S.1)) between time t+Δt and 𝑡 gives Δ𝒖(𝑡,𝑋)=𝒖(𝑡+Δ𝑡,𝑋)−𝒖(𝑡,𝑋)=𝑌J𝑋^𝑣Ul𝒖((𝜏)m𝑑𝜏-^`--Ll𝜼U/−𝜼Um.WUH$ Given the cell density 𝑋 at time 𝑡, taking expectation of the equation above gives 𝔼[𝒖(𝑡+Δ𝑡,𝑋)|𝑋]−𝔼[𝒖(𝑡,𝑋)|𝑋]	=𝔼³𝑌J𝑋^𝑣Ul𝒖((𝜏)m𝑑𝜏-^`--L|𝑋´l𝜼U/−𝜼UmWUH$=𝑋W𝔼¤𝑌WΛU(𝑡+Δ𝑡)X¥−𝔼¤𝑌WΛU(𝑡)X¥Xl𝜼U/−𝜼UmWUH$=𝑋l𝔼ΛU(𝑡+Δ𝑡)−𝔼ΛU(𝑡)ml𝜼U/−𝜼UmWUH$. By dividing Δ𝑡 and taking limit from both sides, the derivative of expected metabolite concentrations is 𝑑𝔼[𝒖(𝑡,𝑋)|𝑋]𝑑𝑡=lim`-→8𝔼[𝒖(𝑡+Δ𝑡,𝑋)|𝑋]−𝔼[𝒖(𝑡,𝑋)|𝑋]Δ𝑡=𝔼ΛU(𝑡+Δ𝑡)−𝔼ΛU(𝑡)Δ𝑡WUH$l𝜼U/−𝜼Um𝑋=𝑁𝑑𝔼[𝚲(𝑡)]𝑑𝑡𝑋 which completes the proof.  A constant flux rate 𝑣Ul𝒖((𝑡)m=𝑣U is often assumed in MFA and EMU method, which indicates a special case of Proposition 1. Notice that >𝔼[𝒖(-,_)|_]>-=𝑁𝒗𝑋 due to the fact 𝚲(𝑡)=∫𝒗𝑑𝑥-8=𝒗𝑡. For the differential equation based metabolic network model, we have deterministic metabolite concentrations 𝒖 36  and flux rates 𝒗. Under the steady state, we have the commonly used dynamic metabolic flux analysis model, i.e.,   >𝒖>-=𝑁𝒗𝑋(S.2)  Therefore, by comparing the equation (S.1) with the deterministic model (S.2), we can interpret the classical PDE/ODE-based dynamic metabolic flux analysis model as a special case of the queueing network with mean metabolite concentrations and mean flux rates, i.e., ignoring cell-to-cell variation, stochastic nature of living cells, metabolic and spatial heterogeneity.   37  Supplementary Figures and Tables Supplementary Fig. 1. Metabolic network for iPSC used for creating intracellular SMN model (adapted from Wang et al. 30) 
  
38  Supplementary Fig. 2. Steady-state metabolite concentration profiles for iPSC aggregates of different sizes. Aggregates sizes shown are 60 𝜇m to 600 𝜇m in radius, where the concentration represent the extracellular conditions within the aggregate. All diffusion effects, porosity 𝜀=0.27 and tortuosity 𝜏=1.5 and initial intracellular metabolite concentrations were the same for all aggregate sizes. 
   
39  Supplementary Fig. 3.  The plot shows the predicted biomass production of different aggregates (ranging from 30 𝜇m to 300 𝜇m in radius) for a duration of one hour based on the simulation results with 100 replicates. The recorded results correspond to 0, 6, 12, …, 72 culture hour respectively. The blue line represents the mean, and the red line represents the RSD of the biomass (i.e., 𝑅𝑆𝐷(&)*'++,ℓ,- with ℓ=30,45,…,300	from equation (11)). 
   40  Supplementary Table 1 Reactions of the metabolic network No. Glycolysis 1 𝑣(𝐻𝐾)=𝑣*'6,ij⋅𝐺𝐿𝐶𝑘*,9b5+𝐺𝐿𝐶⋅𝐾&,9:k𝐾&,9:k+𝐺6𝑃⋅𝐾&,bQ5-)ij𝐾&,bQ5-)ij+𝐿𝐴𝐶 2 𝑣(𝑃𝐺𝐼)=𝑣*'6,k9l⋅𝐺6𝑃𝐾*,9:k+𝐺6𝑃 3 𝑣(𝑃𝐹𝐾/𝐴𝐿𝐷)=𝑣*'6,kmj/Qbn⋅𝐹6𝑃𝐾*,m:k+𝐹6𝑃	 4 𝑣(𝑃𝐺𝐾)=𝑣*'6,k9j⋅𝐺𝐴𝑃𝐾*,9Qk+𝐺𝐴𝑃 5 𝑣(𝑃𝐾)=𝑣*'6,kj⋅𝑃𝐸𝑃𝐾*,kok⋅M1+𝐾',m:k𝐹6𝑃N+𝑃𝐸𝑃 6f 𝑣(𝐿𝐷𝐻𝑓)=𝑣*'6,pbni⋅𝑃𝑌𝑅𝐾*,kq%+𝑃𝑌𝑅 6r 𝑣(𝐿𝐷𝐻𝑟)=𝑣*'6,rbni⋅𝐿𝐴𝐶𝐾*,bQ5+𝐿𝐴𝐶⋅𝐾&,kq%𝐾&,kq%+𝑃𝑌𝑅 7 𝑣(𝑃𝑦𝑟𝑇)=𝑣*'6,k?rs⋅𝐸𝑃𝑌𝑅𝐾*,okq%+𝐸𝑃𝑌𝑅⋅𝐾&,bQ5-)kq%𝐾&,bQ5-)kq%+𝐿𝐴𝐶 8f 𝑣(𝐿𝑎𝑐𝑇𝑓)=𝑣*'6,pb';s⋅𝐿𝐴𝐶𝐾*,bQ5+𝐿𝐴𝐶 8r 𝑣(𝐿𝑎𝑐𝑇𝑟)=𝑣*'6,rb';s⋅𝐸𝐿𝐴𝐶𝐾*,obQ5+𝐸𝐿𝐴𝐶  PPP 9 𝑣(𝑂𝑃)=𝑣*'6,tk⋅𝐺6𝑃𝐾*,9:k+𝐺6𝑃 10 𝑣(𝑁𝑂𝑃)=𝑣*'6,Gtk⋅𝑅𝑢5𝑃𝐾*,%uTk+𝑅𝑢5𝑃  TCA 41  11 𝑣(𝑃𝐷𝐻)=𝑣*'6,kni⋅𝑃𝑌𝑅𝐾*,kq%+𝑃𝑌𝑅⋅ 12 𝑣(𝐶𝑆)=𝑣*'6,5v⋅𝐴𝑐𝐶𝑜𝐴𝐾*,Q;5)Q+𝐴𝑐𝐶𝑜𝐴⋅𝑂𝐴𝐴𝐾*,tQQ+𝑂𝐴𝐴 13f 𝑣(𝐶𝐼𝑇𝑆/𝐼𝑆𝑂𝐷𝑓)=𝑣*'6,p5lsv/lvtn⋅𝐶𝐼𝑇𝐾*,5ls+𝐶𝐼𝑇 13r 𝑣(𝐶𝐼𝑇𝑆/𝐼𝑆𝑂𝐷𝑟)=𝑣*'6,r5lsv/lvtn⋅𝐴𝐾𝐺𝐾*,Qj9+𝐴𝐾𝐺 14   𝑣(𝐴𝐾𝐺𝐷𝐻)=𝑣*'6,Qj9ni⋅𝐴𝐾𝐺𝐾*,Qj9+𝐴𝐾𝐺 15 𝑣(𝑆𝐷𝐻)=𝑣*'6,vni⋅𝑆𝑈𝐶𝐾*,vw5+𝑆𝑈𝐶 16f 𝑣(𝐹𝑈𝑀𝑓)=𝑣*'6,pmwx⋅𝐹𝑈𝑀𝐾*,mwx+𝐹𝑈𝑀 16r 𝑣(𝐹𝑈𝑀𝑟)=𝑣*'6,rmwx⋅𝑀𝐴𝐿𝐾*,xQb+𝑀𝐴𝐿 17f 𝑣(𝑀𝐷𝐻𝑓)=𝑣*'6,pxni⋅𝑀𝐴𝐿𝐾*,xQb+𝑀𝐴𝐿 17r 𝑣(𝑀𝐷𝐻𝑟)=𝑣*'6,rxni⋅𝑂𝐴𝐴𝐾*,tQQ+𝑂𝐴𝐴  Anaplerosis and Amino Acid 18 𝑣(𝑀𝐸)=𝑣*'6,xo⋅𝑀𝐴𝐿𝐾*,xQb+𝑀𝐴𝐿 19 𝑣(𝑃𝐶)=𝑣*'6,k5⋅𝑃𝑌𝑅𝐾*,kq%+𝑃𝑌𝑅 20f 𝑣(𝐺𝐿𝑁𝑆𝑓)=𝑣*'6,p9bGv⋅𝐺𝐿𝑁𝐾*,9bG+𝐺𝐿𝑁⋅𝐾&,bQ5-)9bGv𝐾&,bQ5-)9bGv+𝐿𝐴𝐶 20r 𝑣(𝐺𝐿𝑁𝑆𝑟)=𝑣*'6,r9bGv⋅𝐺𝐿𝑈𝐾*,9bw+𝐺𝐿𝑈⋅𝑁𝐻4𝐾*,Gi.+𝑁𝐻4 42  21f 𝑣(𝐺𝐿𝐷𝐻𝑓)=𝑣*'6,p9bni⋅𝐺𝐿𝑈𝐾*,9bw+𝐺𝐿𝑈 21r 𝑣(𝐺𝐿𝐷𝐻𝑟)=𝑣*'6,r9bni⋅𝐴𝐾𝐺𝐾*,Qj9+𝐴𝐾𝐺⋅𝑁𝐻4𝐾*,Gi.+𝑁𝐻4 22f 𝑣(𝐴𝑙𝑎𝑇𝐴𝑓)=𝑣*'6,pQ='sQ⋅𝐺𝐿𝑈𝐾*,9bw+𝐺𝐿𝑈⋅𝑃𝑌𝑅𝐾*,kq%+𝑃𝑌𝑅 22r 𝑣(𝐴𝑙𝑎𝑇𝐴𝑟)=𝑣*'6,rQ='sQ⋅𝐴𝐿𝐴𝐾*,Q='+𝐴𝑙𝑎⋅𝐴𝐾𝐺𝐾*,Qj9+𝐴𝐾𝐺⋅M1+𝐾',9bG𝐺𝐿𝑁N 23 𝑣(𝐴𝑙𝑎𝑇)=𝑣*'6,Q='s⋅𝐴𝐿𝐴𝐾*,QbQ+𝐴𝐿𝐴 24 𝑣(𝐺𝑙𝑢𝑇)=𝑣*'6,9=us⋅𝐺𝐿𝑈𝐾*,9bw+𝐺𝐿𝑈 25 𝑣(𝐺𝑙𝑛𝑇)=𝑣*'6,9="s⋅𝐸𝐺𝐿𝑁𝐾*,o9bG+𝐸𝐺𝐿𝑁⋅𝐾&,9bG𝐾&,9bG+𝐺𝐿𝑁 26 𝑣(𝑆𝐴𝐿)=𝑣*'6,vQb⋅𝑆𝐸𝑅𝐾*,v<r+𝑆𝐸𝑅 27f 𝑣(𝐴𝑆𝑇𝐴𝑓)=𝑣*'6,pQvsQ⋅𝐴𝑆𝑃𝐾*,Qvk+𝐴𝑆𝑃⋅𝐴𝐾𝐺𝐾*,Qj9+𝐴𝐾𝐺 27r 𝑣(𝐴𝑠𝑝𝑇)=𝑣*'6,Q+ys⋅𝐸𝐴𝑆𝑃𝐾*,oQvk+𝐸𝐴𝑆𝑃 28 𝑣(𝐴𝑠𝑝𝑇)=𝑣*'6,Q+ys⋅𝐸𝐴𝑆𝑃𝐾*,oQvk 29 𝑣(𝐴𝐶𝐿)=𝑣*'6,Q5b⋅𝐶𝐼𝑇𝐾*,5ls+𝐶𝐼𝑇  Biomass 30 𝑣(𝐵𝑖𝑜𝑚𝑎𝑠𝑠)=𝑣*'6,z&)*'++⋅𝐺𝐿𝑁𝐾*,9bG+𝐺𝐿𝑁⋅𝐺𝐿𝐶𝐾*,9b5+𝐺𝐿𝐶⋅𝐺𝐿𝑈𝐾*,9bw+𝐺𝐿𝑈⋅𝐴𝐿𝐴𝐾*,QbQ+𝐴𝐿𝐴⋅𝐴𝑆𝑃𝐾*,Qvk+𝐴𝑆𝑃⋅𝑆𝐸𝑅𝐾*,vo%+𝑆𝐸𝑅⋅𝐺𝐿𝑌𝐾*,9bq+𝐺𝐿𝑌 43  Supplementary Table 2 Description of Metabolites Component Description Component Description ACCoA Acetyl-CoezymeA ALA Alanine AKG α-Ketoglutarate ASP Aspartate CIT Citrate LAC Lactate CO2 Intracellular Carbonoxygen GLN Glutamine F6P Fructose 6-Phosphate EGLY Extracellular Glycine G6P Glucose 6-Phosphate SER Extracellular Serine GAP Glyceraldehyde 3-Phosphate GLC Extracellular Glucose GLU Glutamate EGLN Extracellular Glutamine GLY Glycine EGLU Extracellular Glutamate MAL Malate EPYR Extracellular Pyruvate OAA Oxaloacetate EASP Extracellular Aspartate PEP Phosphoenolpyruvate EALA Extracellular Alanine FUM Fumarate ELAC Extracellular Lactate Ru5P Ribulose 5-Phosphate NH4 Extracellular Ammonia SUC Succinate LIPID Lipid PYR Pyruvate Bio Cell Density 44  Supplementary Table 3 Description of Enzymes Abbreviation Description  EC-No. HK Hexokinase 2.7.1.1 PGI Phosphoglucose Isomerase 5.3.1.9 PFK/ALD Phosphofructokinase/Aldolase 2.7.1.11/4.1.2.13 PGK Phosphoglycerate Kinase 2.7.2.3 PK Pyruvate Kinase 2.7.1.40 OP Oxidative Phase of PPP   NOP Non-oxidative Phase of PPP   PyrT Membrane Transport of Pyruvate   SAL Membrane Transport of Serine   LDH Lactate Dehydrogenase 1.1.1.27 AlaTA Alanine Transaminase 2.6.1.2 PC Pyruvate Carboxylase 6.4.1.1 PDH Pyruvate Dehydrogenase  1.2.4.1 CS Citrate (Si)-Synthase 2.3.3.1 CITS/ISOD Aconitase/Isocitrate Dehydrogenase 4.2.1.3/1.1.1.41 GLDH Glutamate Dehydrogenase 1.4.1.2 GluT Membrane Transport of Glutamate   GLNS Glutamine Synthetase 6.3.1.2 AKGDH α-ketoglutarate Dehydrogenase 1.2.1.105 SDH Succinate Dehydrogenase 1.3.5.1 MDH Malate Dehydrigenase 1.1.1.37 45  ME Malic Enzyme 1.1.1.40 ASTA Aspartate Aminotransferase 2.6.1.1 ACL ATP citrate synthase 2.3.3.8 FUM Fumarase 4.2.1.2 46  Supplementary Table 4. Diffusion Coefficients for Extracellular Metabolites (10-9 m2/s) Metabolite Diffusion Coefficients	(𝐷&') Metabolite Diffusion Coefficients (𝐷&') Pyruvate 1.1249 Glucose 0.651 Alanine 0.9150 Glutamine 0.7652 Aspartate 0.74153 Glutamate 0.70854 Glycine 1.0450 Lactate 1.03349 Serine 0.89150 Ammonia 1.8655 47  Supplementary Table 5. Comparison of reaction flux rates between outer and inner cells in aggregates with a radius of 60, 120,240 and 360	𝝁𝐦 at 24 hours. Aggregate Radius 60 𝝁𝐦 120 𝝁𝐦 240 𝝁𝐦 360 𝝁𝐦 Reaction Outer Cells Inner Cells Outer Cells Inner Cells Outer Cells Inner Cells Outer Cells Inner Cells HK 1460.62 1425.16 1460.62 1349.82 1460.62 1134.31 1460.85 927.78 PGI 1202.59 1193.26 1202.59 1171.14 1202.59 1085.17 1202.50 882.00 PEKALD 1177.50 1169.23 1177.50 1149.71 1177.50 1074.26 1177.37 864.47 PGK 2282.12 2267.92 2282.12 2234.48 2282.12 2105.11 2281.76 1679.23 PK 2175.71 2164.09 2175.71 2136.83 2175.71 2031.51 2175.26 1607.29 LDHf 2077.26 2065.22 2077.26 2035.65 2077.26 1920.72 2076.80 1536.53 LDHr 80.42 80.82 80.42 81.06 80.42 79.50 80.41 69.00 PyrT 92.29 85.60 92.29 69.14 92.29 15.40 92.29 0.27 LacTf 2353.55 2364.75 2353.55 2370.20 2353.55 2319.61 2353.15 2002.84 LacTr 478.28 498.90 478.28 527.27 478.28 563.52 478.28 578.95 OP 10.15 10.07 10.15 9.88 10.15 9.16 10.15 7.44 NOP 3.27 3.25 3.27 3.19 3.27 2.97 3.27 2.26 PDH 139.79 138.98 139.79 136.99 139.79 129.26 139.76 103.40 CS 127.10 126.53 127.10 125.10 127.10 119.24 127.06 101.82 CITSISODf 36.02 35.86 36.02 35.45 36.02 33.81 36.01 29.33 CITSISODr 5.56 5.49 5.56 5.39 5.56 5.07 5.55 4.65 AKGDH 126.00 124.56 126.00 122.28 126.00 115.01 125.96 105.37 SDH 136.59 136.03 136.59 135.14 136.59 132.13 136.62 148.53 FUMf 159.99 159.88 159.99 159.69 159.99 159.04 160.01 165.23 FUMr 6.80 6.79 6.80 6.77 6.80 6.67 6.80 6.54 MLDf 242.60 242.22 242.60 241.35 242.60 237.95 242.59 233.33 MLDr 81.01 80.98 81.01 80.96 81.01 80.96 81.01 79.53 ME 84.95 84.82 84.95 84.51 84.95 83.32 84.95 81.70 PC 39.00 38.77 39.00 38.22 39.00 36.06 38.99 28.85 GLNSf 254.08 254.34 254.08 252.51 254.08 238.57 254.06 202.43 GLNSr 60.54 63.67 60.54 67.07 60.54 67.77 60.52 52.58 GLDHf 85.23 83.11 85.23 80.39 85.23 74.42 85.20 55.94 GLDHr 3.03 3.23 3.03 3.46 3.03 3.55 3.03 3.36 48  AlaTAf 171.37 166.14 171.37 158.40 171.37 138.36 171.26 83.19 AlaTAr 139.01 133.77 139.01 126.57 139.01 109.85 138.91 65.69 AlaT 24.61 24.13 24.61 23.42 24.61 21.30 24.59 12.24 GluT 55.04 53.67 55.04 51.92 55.04 48.06 55.02 36.12 GlnT 199.84 196.51 199.84 190.90 199.84 175.92 199.85 159.14 SAL 11.28 11.23 11.28 11.09 11.28 10.28 11.28 6.08 ASTAf 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 ASTAr 5.80 6.10 5.80 6.43 5.80 6.49 5.80 4.95 ASPT 1.09 1.09 1.09 1.07 1.09 1.00 1.09 0.90 ACL 94.37 93.94 94.37 92.89 94.37 88.59 94.34 76.85 Biomass 30.88 33.90 30.88 35.21 30.88 29.00 30.83 3.32 Sum Flux 15715.36 15634.04 15715.36 15411.55 15715.36 14492.93 15713.21 12009.12 Difference  of Sum Fluxes 81.32 303.81 1222.43 3704.09    49  Supplementary Table 6 Comparison of reaction flux rates between outer and inner cells in aggregates with a radius of 60, 120,240 and 360	𝝁𝐦 at 48 hours. Aggregate Radius 60 𝝁𝐦 120 𝝁𝐦 240 𝝁𝐦 360 𝝁𝐦 Reaction Outer Cells Inner Cells Outer Cells Inner Cells Outer Cells Inner Cells Outer Cells Inner Cells HK 958.80 950.99 958.80 930.32 958.80 834.98 958.82 691.52 PGI 1152.67 1134.02 1152.67 1088.34 1152.67 913.23 1152.65 713.28 PEKALD 1176.10 1158.30 1176.10 1114.16 1176.10 937.13 1176.08 725.62 PGK 2382.12 2348.27 2382.12 2263.44 2382.12 1908.75 2382.07 1466.69 PK 2407.84 2376.52 2407.84 2297.16 2407.84 1947.74 2407.78 1483.59 LDHf 2413.83 2384.48 2413.83 2311.43 2413.83 1983.97 2419.50 1542.15 LDHr 94.82 94.63 94.82 93.96 94.82 87.31 94.80 69.51 PyrT 19.71 16.06 19.71 9.52 19.71 1.05 19.71 0.03 LacTf 2803.66 2794.63 2803.66 2767.51 2803.66 2550.49 2803.53 2017.84 LacTr 568.73 570.49 568.73 573.86 568.73 581.28 568.73 586.22 OP 9.73 9.57 9.73 9.19 9.73 7.71 9.73 6.02 NOP 3.29 3.24 3.29 3.12 3.29 2.64 3.29 2.05 PDH 162.44 160.47 162.44 155.55 162.44 133.51 162.82 103.78 CS 163.88 162.14 163.88 157.84 163.88 138.47 163.84 104.27 CITSISODf 47.20 46.70 47.20 45.49 47.20 40.09 47.32 31.19 CITSISODr 6.92 6.83 6.92 6.64 6.91 5.97 6.71 4.35 AKGDH 156.82 154.81 156.82 150.65 156.82 135.43 152.07 98.69 SDH 153.60 151.83 153.60 148.47 153.60 136.73 153.74 115.77 FUMf 155.06 153.66 155.06 151.14 155.06 142.42 155.04 127.58 FUMr 7.40 7.35 7.40 7.23 7.40 6.77 7.38 11.96 MLDf 263.98 262.03 263.98 257.92 263.98 241.53 263.26 426.62 MLDr 85.40 85.36 85.40 85.32 85.40 85.23 85.40 84.55 ME 92.44 91.75 92.44 90.32 92.44 84.58 92.19 149.39 PC 45.31 44.76 45.31 43.39 45.31 37.25 45.42 28.95 GLNSf 231.57 229.56 231.57 224.98 231.57 209.34 230.77 174.56 GLNSr 68.44 68.21 68.44 67.76 68.44 67.33 70.36 67.17 GLDHf 77.75 76.84 77.75 75.20 77.75 72.62 79.94 71.18 GLDHr 4.68 4.66 4.68 4.60 4.68 4.26 4.54 3.16 50  AlaTAf 181.65 177.35 181.65 168.24 181.66 139.44 187.20 106.24 AlaTAr 148.56 144.91 148.56 137.60 148.53 117.27 65.23 0.00 AlaT 23.45 23.04 23.45 22.20 23.45 20.00 10.44 0.00 GluT 50.21 49.62 50.21 48.56 50.21 46.89 51.62 45.96 GlnT 167.66 165.68 167.66 160.91 167.66 141.28 168.29 110.69 SAL 9.23 8.89 9.23 7.82 9.23 0.84 9.23 0.00 ASTAf 0.03 0.03 0.03 0.03 0.03 0.05 0.03 0.04 ASTAr 6.92 6.89 6.92 6.84 6.92 6.79 7.11 6.72 ASPT 0.96 0.95 0.96 0.94 0.96 0.88 0.96 0.79 ACL 123.65 122.35 123.65 119.17 123.65 105.03 123.96 81.72 Biomass 53.47 52.07 53.47 46.93 53.46 6.41 24.06 0.00 Sum Flux 16479.95 16299.95 16479.95 15853.77 16479.91 13882.69 16365.61 11259.87 Difference  of Sum Fluxes 180.00 626.18 2597.22 5105.75   